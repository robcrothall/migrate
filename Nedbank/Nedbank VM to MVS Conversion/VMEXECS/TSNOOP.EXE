&TRACE
VMFCLEAR
&IF &N = 0    &GOTO -NOREW
&IF &N NE 2   &GOTO -SNAFU
&IF &1 NE (   &GOTO -SNAFU
&IF &2 NE REW &GOTO -SNAFU
    TAPE REW
-NOREW
    ESTATE TAPE SNOOP A
    &XC = &RC
&IF &XC = 28  &GOTO -OK1
&IF &XC NE 0  &GOTO -SNAFU2
-RETY
    &TYPE TAPE SNOOP FILE ALREADY EXISTS REPLY DELETE OR CANCEL
    &READ VARS &REP
&IF .&REP = .CANCEL  &EXIT 128
&IF .&REP NE .DELETE &GOTO -RETY
    ERASE TAPE SNOOP
-OK1
    FI IN CLEAR
    FI OUT CLEAR
    FI IN TAP1 (RECFM U BLKSIZE 32000 LEAVE
    FI OUT DISK TAPE SNOOP A (RECFM VB BLKSIZE 32004 LRECL 32000
-MOVV
    MOVE IN OUT
    ESTATE TAPE SNOOP A
    &XC = &RC
&IF &XC = 28 &GOTO -NOFILE
&IF &XC NE 0 &GOTO -SNAFU3
    FI IN CLEAR
    FI OUT CLEAR
    &TYPE QFILE OF DISK FILE JUST CREATED FOLLOWS
    &TYPE
    &TYPE
    QFILE TAPE SNOOP A
    &TYPE
    &TYPE
    &TYPE PRESS CLEAR OR PA2 TO BROWSE THE FILE NOW
*MFCLEARCRN MORE
    B TAPE SNOOP
&EXIT
-NOFILE
    &TYPE STAND ALONE TAPE MARK ENCOUNTERED, TRYING NEXT FILE
&GOTO -MOVV
-SNAFU
    &TYPE TSNOOP ALLOWS FOR ( REW ONLY AS OPTION
&EXIT 256
-SNAFU2
    &TYPE ESTATE ERROR RC &XC ON TAPE SNOOP A
&EXIT 256
-SNAFU3
    &TYPE ESTATE ERROR RC &XC ON TAPE SNOOP A AFTER LOAD
&EXIT 256
